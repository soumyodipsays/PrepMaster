@model PrepMaster.Models.TestModel
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    .custom-hover {
        transition: all 0.25s ease;
        cursor: pointer;
    }

        .custom-hover:hover {
            transform: translateY(-6px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.12);
        }
</style>

<div class="card custom-hover border-0 shadow-lg rounded-4 p-2" style="max-width: 380px; background:#f8fafc;">
    <div class="card-body p-3">

        <!-- Top Row -->
        <div class="d-flex justify-content-between align-items-center mb-2">
            <span class="badge px-2 py-1 rounded-3" style="background:#e0e7ff; color:#4f46e5; font-size:12px;">
                @Model.SubjectName
            </span>

            <small class="text-muted d-flex align-items-center gap-1" style="font-size:13px;">
                <i class="bi bi-clock"></i>
                <span id="durationText"></span>
            </small>
        </div>

        <!-- Title -->
        <h5 class="fw-bold mb-2" style="color:#1e293b;">
            @Model.Title
        </h5>

        <!-- Description -->
        <p class="text-muted mb-2" style="font-size:14px;">
            @Model.Description
        </p>

        <!-- Due -->
        <p class="mb-3" style="color:#64748b; font-size:13px;">
            Due: <span id="dueText"></span>
        </p>

        <!-- Button -->
        <button class="btn w-100 text-white fw-semibold py-2 rounded-3"
                style="background:linear-gradient(90deg,#4f46e5,#6366f1); border:none; font-size:14px;">
            Start Test
        </button>

    </div>
</div>

<script>
    $(document).ready(function () {
     console.log('@Model.EndDateTime');

    // Pass DateTime from Razor (ISO format)
    var startTime = '@Model.StartDateTime.ToString("yyyy-MM-ddTHH:mm:ss")';
    var endTime = '@Model.EndDateTime.ToString("yyyy-MM-ddTHH:mm:ss")';

    // Convert to JS Date
    var start = new Date(startTime);
    var end = new Date(endTime);

    var endParts = endTime.split("T");
    var endDate = endParts[0];
    var endClock = endParts[1];

    console.log("End Date:", endDate);
    console.log("End Time:", endClock);

    var diffMs = end - start;
    var diffMinutes = Math.floor(diffMs / 60000);

    var hours = Math.floor(diffMinutes / 60);
    var minutes = diffMinutes % 60;

    var duration = hours + " hr " + minutes + " min";
    $("#durationText").text(duration);

    var today = new Date();
    today.setHours(0,0,0,0);

    var startDate = new Date(startTime);
    startDate.setHours(0,0,0,0);

    var diffDays = Math.ceil((startDate - today) / (1000 * 60 * 60 * 24));

    var dueText = "";

    if (diffDays > 0)
        dueText = diffDays + " days left";
    else if (diffDays === 0)
        dueText = "Today";
    else
        dueText = "Expired";

    $("#dueText").text(dueText);

});
</script>